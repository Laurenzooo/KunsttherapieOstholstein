---
import Layout from '../layouts/Layout.astro';
import IndexPage from '../components/pages-migration/Index.tsx';
import { getImage } from "astro:assets";

// Import local assets
import heroImgAsset from "../assets/hero_background.webp";
import symptomeImgAsset from "../assets/symptome.webp";
import wuenscheImgAsset from "../assets/wuensche.webp";
import beziehungenImgAsset from "../assets/beziehungen.webp";
import trauerImgAsset from "../assets/trauer-abschied.webp";
import entscheidungenImgAsset from "../assets/entscheidungen.webp";
import traumataImgAsset from "../assets/traumata.webp";

// Generate responsive hero images for LCP optimization
// Mobile: TINY (200px, quality 40) - heavily compressed since it's displayed blurred anyway
// Tablet: medium (800px)
// Desktop: full resolution (1920px)
const heroMobile = await getImage({ src: heroImgAsset, width: 200, quality: 40, format: 'webp' });
const heroTablet = await getImage({ src: heroImgAsset, width: 800, quality: 75, format: 'webp' });
const heroDesktop = await getImage({ src: heroImgAsset, width: 1920, quality: 80, format: 'webp' });

// Build srcset and sizes for responsive loading
// sizes attribute tells browser: use 200px image for screens up to 767px, then 800px up to 1200px, otherwise 1920px
const heroSrcset = `${heroMobile.src} 200w, ${heroTablet.src} 800w, ${heroDesktop.src} 1920w`;
const heroSizes = "(max-width: 767px) 200px, (max-width: 1200px) 800px, 1920px";

// Optimize other images
const symptomeImg = await getImage({ src: symptomeImgAsset, width: 600, format: 'webp' });
const wuenscheImg = await getImage({ src: wuenscheImgAsset, width: 600, format: 'webp' });
const beziehungenImg = await getImage({ src: beziehungenImgAsset, width: 600, format: 'webp' });
const trauerImg = await getImage({ src: trauerImgAsset, width: 600, format: 'webp' });
const entscheidungenImg = await getImage({ src: entscheidungenImgAsset, width: 600, format: 'webp' });
const traumataImg = await getImage({ src: traumataImgAsset, width: 600, format: 'webp' });

const symptomeOptimized = { src: symptomeImg.src, srcSet: symptomeImg.srcSet.attribute };
const wuenscheOptimized = { src: wuenscheImg.src, srcSet: wuenscheImg.srcSet.attribute };
const beziehungenOptimized = { src: beziehungenImg.src, srcSet: beziehungenImg.srcSet.attribute };
const trauerOptimized = { src: trauerImg.src, srcSet: trauerImg.srcSet.attribute };
const entscheidungenOptimized = { src: entscheidungenImg.src, srcSet: entscheidungenImg.srcSet.attribute };
const traumataOptimized = { src: traumataImg.src, srcSet: traumataImg.srcSet.attribute };
---

<Layout description="Kunsttherapie und Maltherapie in Eutin. Begleitung bei Trauer, Abschied und persÃ¶nlichen Themen. Entdecken Sie die heilende Kraft des Malens.">
	<!-- Direct mobile preload - critical for 3G performance, browser finds this immediately -->
	<link 
		rel="preload" 
		href={heroMobile.src}
		as="image"
		type="image/webp"
		fetchpriority="high"
		media="(max-width: 767px)"
		slot="head" 
	/>
	<!-- Desktop/tablet preload -->
	<link 
		rel="preload" 
		href={heroDesktop.src}
		as="image"
		type="image/webp"
		fetchpriority="high"
		media="(min-width: 768px)"
		slot="head" 
	/>
	
	<!-- LCP Hero Background Image - Server rendered, immediately discoverable by preload scanner -->
	<div class="hero-bg-wrapper">
		<img
			src={heroMobile.src}
			srcset={heroSrcset}
			sizes={heroSizes}
			alt=""
			loading="eager"
			fetchpriority="high"
			decoding="sync"
			class="hero-bg-image"
		/>
	</div>
	
	<IndexPage 
		client:idle 
		currentPath={Astro.url.pathname} 
		symptomeImg={symptomeOptimized}
		wuenscheImg={wuenscheOptimized}
		beziehungenImg={beziehungenOptimized}
		trauerImg={trauerOptimized}
		entscheidungenImg={entscheidungenOptimized}
		traumataImg={traumataOptimized}
	/>
</Layout>

<style>
	/* Hero wrapper - matches the hero section dimensions */
	.hero-bg-wrapper {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100dvh; /* Full viewport height */
		min-height: 600px;
		overflow: hidden;
		z-index: -10;
		pointer-events: none;
	}
	
	/* LCP Hero image - fills the wrapper */
	.hero-bg-image {
		position: absolute;
		inset: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		object-position: right center;
	}
	
	@media (min-width: 768px) {
		.hero-bg-image {
			object-position: center;
		}
	}
	
	/* Apply blur on mobile via CSS filter - matches the original design */
	@media (max-width: 767px) {
		.hero-bg-image {
			filter: blur(8px);
			transform: scale(1.02); /* Prevent blur edges from showing */
		}
	}
</style>

